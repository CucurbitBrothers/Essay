<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.4.0 (460661)"/><meta name="author" content="1404001663@qq.com"/><meta name="created" content="2018-09-01 03:44:41 +0000"/><meta name="source" content="desktop.win"/><meta name="source-application" content="yinxiang.win32"/><meta name="source-url" content="http://docs.jinkan.org/docs/celery/"/><meta name="updated" content="2020-04-29 07:18:23 +0000"/><title>41-celery，RabbitMq</title></head><body><div><h1 style="margin: 0px 0px 10px; padding: 0px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 12pt; color: rgb(62, 67, 73); font-family: Futura, &quot;Trebuchet MS&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">Celery - 分布式任务队列</span></span></h1><div><br/></div><div><br/></div><div><span style="font-size: 10pt; font-weight: bold;">问题：</span></div><ol><li><div><span style="font-size: 10pt;">讲下celery的作用及实现原理？</span></div></li><ul><li><div><span style="font-size: 13px;">分布式任务队列管理工具，通过它可以轻松的实现任务的异步处理</span></div></li><li><div><span style="font-size: 13px;">使用场景</span></div></li><ul><li><div><span style="font-size: 13px;">异步任务</span></div></li><li><div><span style="font-size: 13px;">定时任务</span></div></li></ul></ul><li><div><span style="font-size: 10pt;">为什么使用celery异步任务？</span></div></li><li><div><span style="font-size: 13px;">RabbitMq</span><span style="font-size: 13px;">重复消费的问题</span></div></li><li><div><span style="font-size: 13px;">RabbitMq</span><span style="font-size: 13px;"><span>消息如何处理</span></span></div></li></ol><div><span style="font-size: 13px;"><br/></span></div><div><span style="font-size: 13px;"><br/></span></div><div><span style="font-size: 13px;"><br/></span></div><div><span style="font-size: 18px;">知识点</span></div><ol><li><div><span style="font-size: 10pt;">简介</span></div></li><ol><li><div><span style="font-size: 10pt;">一个由 Python 编写的简单、灵活、可靠的用来处理大量信息的分布式系统,</span></div></li><li><div><span style="font-size: 10pt;">专注于实时任务处理，支持任务调度</span></div></li><li><div><span style="font-size: 10pt;">一个分布式队列的管理工具</span></div></li><li><div><span style="font-size: 10pt;">Celery 本身不是任务队列，它是管理分布式任务队列的工具</span></div></li><li><div><span style="font-size: 10pt;">提供了对多种语言的支持</span></div></li><li><div><span style="font-size: 10pt;">celery默认的并发方式是prefork,也就是多进程的方式，这里只是celery对multiprocessing.Pool进行了轻量的改造</span></div></li></ol><li><div><span style="font-size: 10pt;">优点</span></div></li><ul><li><div><span style="font-size: 10pt;">简单：一旦熟悉了celery的工作流程后，配置和使用还是比较简单的</span></div></li><li><div><span style="font-size: 10pt;">高可用：当任务执行失败或执行过程中发生连接中断，celery 会自动尝试重新执行任务</span></div></li><li><div><span style="font-size: 10pt;">快速：一个单进程的celery每分钟可处理上百万个任务</span></div></li><li><div><span style="font-size: 10pt;">灵活： 几乎celery的各个组件都可以被扩展及自定制，</span></div></li><ul><li><div><span style="font-size: 10pt;">可以自制连接池、 序列化、压缩模式、日志、调度器、消费者、生产者、自动扩展、 中间人传输或更多。</span></div></li></ul></ul><li><div><span style="font-size: 10pt;">支持</span></div></li><ol><li><div><span style="font-size: 10pt;">* 中间人</span></div><div><span style="font-size: 10pt;">   * RabbitMQ, Redis,</span></div></li><li><div><span style="font-size: 10pt;">* 并发</span></div><div><span style="font-size: 10pt;">   * prefork（多进程）,</span></div><div><span style="font-size: 10pt;">   * Eventlet, gevent</span></div><div><span style="font-size: 10pt;">   * 多线程/单线程</span></div></li><li><div><span style="font-size: 10pt;">* 结果存储</span></div><div><span style="font-size: 10pt;">   * AMQP, Redis</span></div><div><span style="font-size: 10pt;">   * memcached, MongoDB</span></div><div><span style="font-size: 10pt;">   * SQLAlchemy, Django ORM</span></div><div><span style="font-size: 10pt;">   * Apache Cassandra</span></div></li><li><div><span style="font-size: 10pt;">* 序列化</span></div><div><span style="font-size: 10pt;">   * pickle, json, yaml, msgpack</span></div><div><span style="font-size: 10pt;">   * zlib, bzip2 压缩</span></div><div><span style="font-size: 10pt;">   * 密码学消息签名</span></div></li></ol><li><div><span style="font-size: 10pt;">架构</span></div></li><ol><li><div><span style="font-size: 10pt;">Celery Beat</span></div></li><ul><li><div><span style="font-size: 10pt;">是一个任务调度器，它以独立进程的形式存在。Celery beat 进程会读取配置文件的内容，周期性地将执行任务的请求发送给任务队列</span></div></li><li><div><span style="font-size: 10pt;">Celery 系统自带的任务生产者</span></div></li></ul><li><div><span style="font-size: 10pt;">Producer</span></div></li><ul><li><div><span style="font-size: 10pt;">调用了Celery提供的API、函数或者装饰器而产生任务并交给任务队列处理的都是任务生产者</span></div></li></ul><li><div><span style="font-size: 10pt;">Broker</span></div></li><ul><li><div><span style="font-size: 10pt;">消息代理，或者叫作消息中间件，接受任务生产者发送过来的任务消息，存进队列再按序分发给任务消费方（通常是消息队列或者数据库）</span></div></li></ul><li><div><span style="font-size: 10pt;">celery worker</span></div></li><ul><li><div><span style="font-size: 10pt;">执行任务的一方，它负责接收任务处理中间方发来的任务处理请求，完成这些任务，并且返回任务处理的结果。</span></div></li><li><div><span style="font-size: 10pt;">Celery worker 默认对应的就是操作系统中的一个进程，也可以是线程，协程</span></div></li></ul><li><div><span style="font-size: 10pt;">结果保存</span></div></li><ul><li><div><span style="font-size: 10pt;">支持任务处理完后将状态信息和结果的保存，以供查询</span></div></li></ul></ol></ol><div><br/></div><div><span style="font-size: 10pt;">            <img src="41-celery%EF%BC%8CRabbitMq.resources/196EC54C-C4FB-4585-87F8-24AA2565EC70.png" height="487" width="558"/><br/></span></div><div><br/></div><ul><li><div><span style="font-size: 10pt;">    启动</span></div></li><ul><li><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165);font-size: 10pt;-evernote-highlight:true;">celery  -A celery_tasks.main  worker  -l info  # 执行celery指令</span></span></div></li><li><div><span style="font-size: 10pt;">$ celery -A tasks worker --loglevel=info</span></div></li></ul></ul><div><br/></div><div><br/></div><div><span style="word-wrap: break-word; white-space: pre-wrap; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="font-size: 10pt; background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">开始编写tasks.py：</span></span></div><div style="margin: 15px 0px; padding: 10px; background: rgb(250, 250, 250); tab-size: 4; overflow: auto; border: 1px solid rgb(221, 221, 221); border-radius: 3px; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="font-size: 10pt; color: rgb(153, 153, 136); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;"># tasks.py</span><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 18px;">import</span> <span style="font-size: 10pt; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">time</span></div><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 18px;">from</span> <span style="font-size: 10pt; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">celery</span> <span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 18px;">import</span> <span style="font-size: 10pt; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">Celery</span></div><div><br/></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">celery = Celery(</span><span style="font-size: 10pt; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">'tasks'</span><span style="font-size: 10pt; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">, broker=</span><span style="font-size: 10pt; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">'</span><a href="redis://localhost:6379/0" style="font-size: 10pt; font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">redis://localhost:6379/0</a><span style="font-size: 10pt; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">'</span><span style="font-size: 10pt; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">)</span></font></div><div><br/></div><div><span style="font-size: 10pt; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">@celery.task</span></div><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 18px;">def</span> <span style="font-size: 10pt; color: rgb(153, 0, 0); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 18px;">sendmail</span><span style="font-size: 10pt; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">(mail):</span></div><div><span style="font-size: 10pt; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">print(</span><span style="font-size: 10pt; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">'sending mail to %s...'</span> <span style="font-size: 10pt; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">% mail[</span><span style="font-size: 10pt; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">'to'</span><span style="font-size: 10pt; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">])</span></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">time.sleep(</span><span style="font-size: 10pt; color: rgb(0, 153, 153); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">2.0</span><span style="font-size: 10pt; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">)</span></font></div><div><font style="font-size: 10pt;"><span style="font-size: 10pt; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">print(</span><span style="font-size: 10pt; color: rgb(221, 17, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">'mail sent.'</span><span style="font-size: 10pt; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">)</span></font></div></div><div style="margin: 15px 0px; word-wrap: break-word; white-space: pre-wrap; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="word-wrap: break-word; white-space: pre-wrap; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(102, 102, 102); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">然后启动Celery处理任务：</span></span></div><div style="margin: 15px 0px; padding: 10px; background: rgb(250, 250, 250); tab-size: 4; overflow: auto; border: 1px solid rgb(221, 221, 221); border-radius: 3px; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="background-color: rgb(250, 250, 250); tab-size: 4; overflow: auto; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(0, 128, 128); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">$</span> <span style="background-color: rgb(250, 250, 250); tab-size: 4; overflow: auto; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">celery -</span><span style="background-color: rgb(250, 250, 250); tab-size: 4; overflow: auto; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(0, 153, 153); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">A</span> <span style="background-color: rgb(250, 250, 250); tab-size: 4; overflow: auto; border: 1px solid rgb(221, 221, 221); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(68, 68, 68); font-family: Consolas, monospace, serif; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">tasks worker --loglevel=info</span></div><div><span style="background: rgb(250, 250, 250); tab-size: 4; overflow: auto; border: 1px solid rgb(221, 221, 221); border-radius: 3px; word-break: break-all; word-wrap: break-word; white-space: pre-wrap; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="background-color: rgb(250, 250, 250);"><span style="background-color: rgb(250, 250, 250); font-size: 10pt; color: rgb(153, 0, 115); font-family: Consolas; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">或者</span></span></span></div><div><span style="font-size: 10pt; color: rgb(153, 0, 115); font-family: Consolas; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">&gt;&gt;&gt;</span> <span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: Consolas; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 18px;">from</span> <span style="font-size: 10pt; color: rgb(68, 68, 68); font-family: Consolas; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">tasks</span> <span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: Consolas; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 18px;">import</span> <span style="font-size: 10pt; color: rgb(68, 68, 68); font-family: Consolas; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">sendmail</span></div><div><span style="font-size: 10pt; color: rgb(153, 0, 115); font-family: Consolas; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">&gt;&gt;&gt;</span> <span style="font-size: 10pt; color: rgb(68, 68, 68); font-family: Consolas; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">sendmail.delay(dict(to=</span><span style="font-size: 10pt; color: rgb(221, 17, 68); font-family: Consolas; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">'</span><a href="mailto:celery@python.org" style="font-size: 10pt; font-family: Consolas; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">celery@python.org</a><span style="font-size: 10pt; color: rgb(221, 17, 68); font-family: Consolas; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">'</span><span style="font-size: 10pt; color: rgb(68, 68, 68); font-family: Consolas; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 400; line-height: 18px;">))</span></div></div><div><br/></div><ul><li><div>链式任务</div></li><ul><li><div><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">有些任务可能需由几个子任务组成，此时调用各个子任务的方式就变的很重要，尽量不要以同步阻塞的方式调用子任务，而是用异步回调的方式进行链式任务的调用：</span></span></div></li></ul><li><div>调用任务</div></li><ul><li><div><span style="font-size: 0.87em; word-break: break-word; background-color: rgb(255, 245, 245); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; overflow-x: auto; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 80, 44); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">delay</span><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">只是</span><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="font-size: 0.87em; word-break: break-word; background-color: rgb(255, 245, 245); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; overflow-x: auto; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 80, 44); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">apply_async</span><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">的快捷方式，二者作用相同，只是</span><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="font-size: 0.87em; word-break: break-word; background-color: rgb(255, 245, 245); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; overflow-x: auto; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(255, 80, 44); font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">apply_async</span><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: -apple-system, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">可以进行更多的任务属性设置，比如 callbacks/errbacks 正常回调与错误回调、执行超时、重试、重试时间等等，</span></div></li></ul></ul><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div><div><br/></div></body></html>