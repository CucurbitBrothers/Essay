<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.4.0 (460661)"/><meta name="author" content="1404001663@qq.com"/><meta name="created" content="2018-09-02 11:49:31 +0000"/><meta name="source" content="desktop.win"/><meta name="source-application" content="yinxiang.win32"/><meta name="source-url" content="file:///J:/heima/uTorrentFile/courseware/%E8%AF%BE%E4%BB%B6-20180618/day14/master_slave.html"/><meta name="updated" content="2020-04-28 14:02:17 +0000"/><title>20-MySQL</title></head><body><div><div style="-webkit-font-smoothing: antialiased; box-sizing: border-box; white-space: pre-wrap; direction: ltr; border: none; overflow: auto; word-wrap: normal; margin: 0px 0px 1.275em; padding: 0.85em 1em; background-color: rgb(247, 247, 247); letter-spacing: 0.2px; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font style="font-size: 24px;">问题</font></div><ol><li><div><span style="font-size: 12px; font-family: Consolas;"><font style="color: rgb(0, 0, 0); --inversion-type-color: simple;">MySQL查询执行过程</font></span></div></li><ol><li><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Consolas; --inversion-type-color: simple;"><img src="20-MySQL.resources/FFABBC7B-6D23-48AF-A93A-10899D148235.png" height="1048" width="1356"/></span></div></li><li><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Consolas; --inversion-type-color: simple;">客户端发送一个查询给服务器。</span></div></li><li><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Consolas; --inversion-type-color: simple;">服务器先检查查询缓存，如果命中，则直接返回缓存中的结果。如果没有没有命中，则进入下一阶段（解析器）。</span></div></li><li><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Consolas; --inversion-type-color: simple;">服务器由解析器检查sql语法是否正确，然后由预处理器检查sql中的表和字段是否存在，最后由查询优器生成执行计划。这一步很耗资源。</span></div></li><li><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Consolas; --inversion-type-color: simple;">mysql根据优化器生成的执行计划，调用存储引擎的API来执行查询。</span></div></li><li><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Consolas; --inversion-type-color: simple;">将结果返回给客户端。</span></div></li></ol><li><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Consolas; --inversion-type-color: simple;">MySQL客户端和服务端之间的通信</span></div></li><ol><li><div><span style="color: rgb(64, 64, 64); font-family: -apple-system, system-ui, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;, &quot;Segoe UI&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font style="font-size: 14px;">在mysql服务器和客户端之间的通信时“半双工”的。就是在同一时刻要么由客户向Mysql服务器发送数据，要么由MySQL服务器向客户端发送数据</font></span></div></li></ol></ol><div><span style="font-size: 12px; color: rgb(42, 27, 51); font-family: Consolas; --inversion-type-color: simple;"><br/></span></div><ul style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; margin: 0px 0px 0.85em; padding: 0px 0px 0px 2em; letter-spacing: 0.2px; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><li><div><span style="font-size: 9pt; color: rgb(137, 89, 168); font-family: Consolas; font-variant-caps: normal; font-variant-ligatures: normal;">完整的select语句</span></div></li></ul><div style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 16px; white-space: pre-wrap; direction: ltr; border: none; overflow: auto; word-wrap: normal; margin: 0px 0px 1.275em; padding: 0.85em 1em; background-color: rgb(247, 247, 247); letter-spacing: 0.2px; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 0.85em; direction: ltr; border: none; white-space: pre; break-inside: avoid; color: rgb(137, 89, 168); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">select</span><span style="font-size: 16px;" /><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 0.85em; direction: ltr; border: none; white-space: pre; break-inside: avoid; color: rgb(137, 89, 168); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">distinct</span><span style="font-size: 16px;" /><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 0.85em; direction: ltr; border: none; white-space: pre; break-inside: avoid; color: rgb(137, 89, 168); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">*</span></div><div><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 0.85em; direction: ltr; border: none; white-space: pre; break-inside: avoid; color: rgb(137, 89, 168); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">from</span><span style="font-size: 16px;" /><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 0.85em; direction: ltr; border: none; white-space: pre; break-inside: avoid; color: rgb(137, 89, 168); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">表名</span></div><div><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 0.85em; direction: ltr; border: none; white-space: pre; break-inside: avoid; color: rgb(137, 89, 168); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">where</span><span style="font-size: 16px;" /><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 0.85em; direction: ltr; border: none; white-space: pre; break-inside: avoid; color: rgb(137, 89, 168); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">....</span></div><div><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 0.85em; direction: ltr; border: none; white-space: pre; break-inside: avoid; color: rgb(137, 89, 168); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">group</span><span style="font-size: 16px;" /><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 0.85em; direction: ltr; border: none; white-space: pre; break-inside: avoid; color: rgb(137, 89, 168); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">by</span><span style="font-size: 16px;" /><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 0.85em; direction: ltr; border: none; white-space: pre; break-inside: avoid; color: rgb(137, 89, 168); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">...</span><span style="font-size: 16px;" /><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 0.85em; direction: ltr; border: none; white-space: pre; break-inside: avoid; color: rgb(137, 89, 168); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">having</span><span style="font-size: 16px;" /><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 0.85em; direction: ltr; border: none; white-space: pre; break-inside: avoid; color: rgb(137, 89, 168); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">...</span></div><div><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 0.85em; direction: ltr; border: none; white-space: pre; break-inside: avoid; color: rgb(137, 89, 168); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">order</span><span style="font-size: 16px;" /><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 0.85em; direction: ltr; border: none; white-space: pre; break-inside: avoid; color: rgb(137, 89, 168); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">by</span><span style="font-size: 16px;" /><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 0.85em; direction: ltr; border: none; white-space: pre; break-inside: avoid; color: rgb(137, 89, 168); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">...</span></div><div><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 0.85em; direction: ltr; border: none; white-space: pre; break-inside: avoid; color: rgb(137, 89, 168); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">limit</span><span style="font-size: 16px;" /><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 0.85em; direction: ltr; border: none; white-space: pre; break-inside: avoid; color: rgb(137, 89, 168); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">start</span><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 0.85em; direction: ltr; border: none; white-space: pre; break-inside: avoid; color: rgb(137, 89, 168); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">,</span><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 0.85em; direction: ltr; border: none; white-space: pre; break-inside: avoid; color: rgb(137, 89, 168); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">count</span></div></div><ul style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; margin-top: 0px; padding: 0px 0px 0px 2em; margin-right: 0px; margin-left: 0px; letter-spacing: 0.2px; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; margin-bottom: 0px !important;"><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;"><div><span style="font-size: 9pt; color: rgb(137, 89, 168); font-family: Consolas; font-variant-caps: normal; font-variant-ligatures: normal;">执行顺序为：</span></div></li><ul style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit; margin: 0px; padding: 0px 0px 0px 2em;"><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;"><div><span style="font-size: 9pt; color: rgb(137, 89, 168); font-family: Consolas; font-variant-caps: normal; font-variant-ligatures: normal;">from 表名</span></div></li><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;"><div><span style="font-size: 9pt; color: rgb(137, 89, 168); font-family: Consolas; font-variant-caps: normal; font-variant-ligatures: normal;">where ....</span></div></li><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;"><div><span style="font-size: 9pt; color: rgb(137, 89, 168); font-family: Consolas; font-variant-caps: normal; font-variant-ligatures: normal;">group by ...</span></div></li><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;"><div><span style="font-size: 9pt; color: rgb(137, 89, 168); font-family: Consolas; font-variant-caps: normal; font-variant-ligatures: normal;">select distinct *</span></div></li><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;"><div><span style="font-size: 9pt; color: rgb(137, 89, 168); font-family: Consolas; font-variant-caps: normal; font-variant-ligatures: normal;">having ...</span></div></li><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;"><div><span style="font-size: 9pt; color: rgb(137, 89, 168); font-family: Consolas; font-variant-caps: normal; font-variant-ligatures: normal;">order by ...</span></div></li><li style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: inherit;"><div><span style="font-size: 9pt; color: rgb(137, 89, 168); font-family: Consolas; font-variant-caps: normal; font-variant-ligatures: normal;">limit start,count</span></div></li></ul><li><div><span style="font-size: 13px; --inversion-type-color:  simple; color: rgb(8, 8, 8); font-family: Consolas;">表备份</span></div></li><ul><li><div><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 0.85em; white-space: pre; direction: ltr; border: none; overflow: auto; word-wrap: normal; letter-spacing: 0.2px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">mysqldump –uroot –p 数据库名 &gt; python.sql;</span></div></li><li><div><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 0.85em; white-space: pre; direction: ltr; border: none; overflow: auto; word-wrap: normal; letter-spacing: 0.2px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">mysql -uroot –p 新数据库名 &lt; python.sql</span></div></li></ul></ul><div><br/></div><div><br/></div><ol><li><div><span style="font-weight: bold;">MySQL数据库引擎:</span></div></li><ul type="a"><li><div>MySQL5.5版本之前默认的是MyISAM存储引擎，5.5版本之后是InnoDB。</div></li><li><div>现在最新的版本是8.0，速度相比5.7提高了两倍，而且默认字符集utf8mb4，在这以前是latin1。</div></li><li><div>MySQL的“utf8”实际上不是真正的UTF-8编码。“utf8”只支持每个字符最多三个字节，而真正的UTF-8是每个字符最多四个字节。MySQL的“utf8mb4”才是真正的“UTF-8”编码, 可以同其他程序的“UTF-8”兼容。</div></li></ul></ol><ul><li><div>关于引擎：常用的就是MyISAM和InnoDB，除了这两个还有CSV（支持从数据库中拷入/拷出CSV文件）、HEAP（也称为MEMORY，通过在内存中创建临时表来存储数据，拥有极高的插入、更新和查询效率，缺点就是不稳定，发生 异常，或者重启电脑都会丢失数据）</div></li></ul><ol type="i"><li><div><span style="font-weight: bold;">InnoDB</span></div></li><ol><li><div>Innodb引擎提供了对数据库ACID事务的支持（原子性，一致性，隔离性，持久性）。</div></li><li><div>并且还提供了行级锁和外键的约束，同时也支持表锁。InnoDB的行级锁基于索引，其他情况下使用表锁。</div></li><li><div>大部分情况都是使用行级锁，它的粒度小，写操作不锁定全表。所以在并发度较高的场景下使用InnoDB会提升效率的。它的设计的目标就是处理大数据容量的数据库系统，</div></li><li><div>InnoDB更适合写密集的的表，适合作为线上事物型数据库。</div></li></ol></ol><ol start="2" type="i"><li><div><span style="font-weight: bold;">MyISAM</span></div></li><ol><li><div>不提供事务的支持，也不支持行级锁和外键，只支持表锁。</div></li><li><div>MyISAM可以支持查询和插入操作的并发进行.而且大量的insert操作时比较快，但是大量update时速度就不尽人意了。</div></li><li><div>如果表的读操作远远多于写操作时，并且不需要事务的支持的。可以将MyIASM作为数据库引擎的首选，它强调的是性能，就读取数据而言比InnoDB更快。</div></li><li><div>MyISAM更适合读密集的表，适用于ROLAP数据仓库</div></li></ol></ol><ol start="2"><li><div>隔离级别</div></li><ol><li><div><span style="font-size: 15px;">隔离级别           脏读（Dirty Read）          不可重复读（NonRepeatable Read）     幻读（Phantom Read）</span><span style="font-size: 15px;"> </span></div></li><li><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(245, 245, 245);"><span style="text-indent: 0px; font-size: medium; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(245, 245, 245); color: rgb(26, 26, 26); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">读未提交</span><span style="text-indent: 0px; font-size: 15px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">（Read uncommitted）        1                         1                    1</span></div></li><li><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(245, 245, 245);"><span style="text-indent: 0px; font-size: medium; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(245, 245, 245); color: rgb(26, 26, 26); font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">读已提交</span><span style="text-indent: 0px; font-size: 15px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">（Read committed）            0                         1                     1</span></div></li><li><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(245, 245, 245);"><span style="text-indent: 0px; font-size: 15px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">可重复读（Repeatable read）          0                         0                     1</span></div></li><ul><li><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(245, 245, 245);"><span style="text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">避免脏读，不可重复读的发生</span></div></li><li><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(245, 245, 245);"><span style="font-size: 13px;">不过会有幻读现象，InnoDB引擎可以通过next-key locks机制来避免幻读</span></div></li></ul><li><div style="margin: 10px auto; padding: 0px; text-indent: 0px; font-size: 13px; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(245, 245, 245);"><span style="text-indent: 0px; font-size: 15px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(245, 245, 245); color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">序列化（Serializable ）                    0                          0                     0</span></div></li><ul><li><div style="margin: 10px auto; padding: 0px; text-indent: 0px; letter-spacing: normal; orphans: 2; text-align: left; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(245, 245, 245);"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14px; color: rgb(50, 50, 50); font-family: ibm-plex-sans, &quot;Helvetica Neue&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">该隔离级别下事务都是串行顺序执行的，MySQL 数据库的 InnoDB 引擎会给读操作隐式加一把读共享锁，从而避免了脏读、不可重读复读和幻读问题。</span></span></div></li></ul></ol><li><div><span style="font-weight: bold;">索引</span></div></li></ol><ol type="a"><ol type="i"><li><div>MySQL索引的类型：</div></li><ol><li><div>主键（聚集）索引，非聚集索引（普通索引、全文索引，唯一索引（unique），），</div></li><ol><li><div>主键索引是唯一索引的特殊类型。求主键中的每个值是唯一的，并且不能为空</div></li><li><div>聚集索引表中各行的物理顺序与键值的逻辑（索引）顺序相同，每个表只能有一个。MySQL里主键就是聚集索引。聚集索引在叶子节点存储的是表中的数据。</div></li><li><div>非聚集索引指定表的逻辑顺序。数据存储在一个位置，索引存储在另一个位置，索引中包含指向数据存储位置的指针。可以理解为：非聚集索引在叶子节点存储的是主键和索引列。使用非聚集索引查询出数据时，拿到叶子节点上的主键，再去根据主键查到想要查找的数据，因此速度会慢一点。</div></li></ol></ol></ol></ol><ol start="2" type="a"><ol type="i"><li><div>特点</div></li><ol><li><div>可以加快数据库的检索速度,但是会降低插入、删除、修改等维护任务的速度。</div></li><li><div>索引需要占物理和内存空间，所以不要建太多，注意平衡。</div></li><li><div>最左匹配原则（<span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, system-ui, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">最左前缀原则</span>）</div></li><ol><li><div>联合索引<span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, system-ui, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">可以包含最多16列</span></div></li><li><div><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, system-ui, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">(col1, col2, col3)这个联合索引的所有前缀 就是(col1), (col1, col2), (col1, col2, col3), 包含这些列的查询都会启用索 引查询.</span></div></li><ul><li><div><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, system-ui, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> (col1, col3)会启用(col1)的索引查询</span></div></li></ul><li><div><span style="font-size: 15px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: -apple-system, system-ui, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">其他所有不在最左前缀里的列都不会启用索引, 即使包含了联合索引里的部分列 也不行. 即上述中的(col2), (col3), (col2, col3) 都不会启用索引去查询.</span></div></li></ol></ol><li><div>Mysql支持Hash索引和B+树索引两种</div></li></ol></ol><ol start="4" type="a"><ol type="i"><li><div><span style="font-weight: bold;">B+树索引:</span></div></li><ol><li><div>将无序的数据变成有序(相对)-----&gt;&gt;底层结构就是B+树</div></li><li><div>B+树检索速度相当较快,所以就会提高检索速度</div></li><li><div>但因为B+树是一种平衡树,对这颗树增删改的话，那肯定会破坏它的原有结构,而要维持平衡树的结构就得做一些额外的工作,因此也就降低了增删改的效率</div></li><ol><li><div>平衡树:一棵空树或它的左右两个子树的高度差的绝对值不超过1，并且左右两个子树都是一棵平衡二叉树</div></li></ol><li><div>MySQL索引为什么采用B+树这种宽树，而不是二叉树，</div></li><ol><li><div><span style="font-size: 16px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: common-ligatures;">B+树的数据全部存放在叶子节点中，非叶子节点用来做索引，而叶子节点中有一个指针指向一下个叶子节点。做这个优化的目的是为了提高区间访问的性能。而正是这个特性决定了B+树更适合用来存储外部数据</span></div></li><li><div>好处：</div></li><ol><li><div>磁盘读写代价低。把节点分块，磁盘I/O变少</div></li><li><div>查询效率稳定</div></li><li><div>数据都存在叶子节点，方便扫库</div></li></ol></ol></ol></ol></ol><ol start="5" type="a"><ol type="i"><li><div><span style="font-weight: bold;">哈希索引</span></div></li><ol><li><div>就是采用一定的哈希算法，把键值换算成新的哈希值</div></li><li><div>只需一次哈希算法即可立刻定位到相应的位置，速度非常快</div></li><li><div>局限性:</div></li><ol><li><div>哈希索引没办法利用索引完成排序</div></li><li><div>不支持最左匹配原则</div></li><li><div>在有大量重复键值情况下，哈希索引的效率也是极低的--&gt;哈希碰撞问题</div></li><li><div>不支持范围查询,同样也就不支持模糊查询.</div></li></ol></ol></ol></ol><ol start="3"><li><div><span style="font-weight: bold;">锁</span></div></li><ol><li><div>我们在操作数据库的时候，可能会由于并发问题而引起的数据的不一致性（数据冲突）,这时候就需要锁了.比较幸运的是锁会隐式添加, 对于UPDATE、DELETE、INSERT语句，InnoDB会自动给涉及数据集加排他锁（X);  MyISAM在执行查询语句SELECT前，会自动给涉及的所有表加读锁，在执行更新操作（UPDATE、DELETE、INSERT等）前，会自动给涉及的表加写锁，这个过程并不需要用户干预</div></li></ol></ol><ol type="a"><li><div>分类:</div></li><ol type="i"><li><div>按使用方式</div></li><ol><li><div>乐观锁/ 悲观锁</div></li></ol><li><div>按照粒度</div></li></ol></ol><ul><ul><ul><li><div>表级锁(MyISAM，CSV，Memory)----共享读锁,独占写锁</div></li><li><div>行级锁(InnoDB)----共享锁(S) / 排它锁(X)</div></li><li><div>页级锁(Berkeley DB—开源的文件数据库，2006年被ORACAL收购)</div></li></ul></ul></ul><ol start="2" type="a"><li><div><span style="font-weight: bold;">乐观锁:</span></div></li><ol><li><div>不是数据库自带的,需要我们自己去实现.一般我们添加一个版本字段来实现</div></li><li><div>在操作数据库(更新操作)时,想法很乐观,认为这次操作不会导致冲突,并不进行其他的特殊处理(不加锁),而是在进行更新后,再去判断是否有冲突</div></li></ol></ol><ol type="i"><li><div><span style="font-weight: bold;">实现:</span></div></li><ol><li><div>在表中的数据进行操作时(更新)，先给数据表加一个版本(version)字段</div></li><li><div>每操作一次，将那条记录的版本号加1。也就是先查询出那条记录，获取出version字段,</div></li><li><div>如果要对那条记录进行操作(更新),则先判断此刻version的值是否与刚刚查询出来时的version的值相等，如果相等，则说明这段期间，没有其他程序对其进行操作，则可以执行更新，将version字段的值加1；</div></li><li><div>如果更新时发现此刻的version值与刚刚获取出来的version的值不相等，则说明这段期间已经有其他程序对其进行操作了，则不进行更新操作。</div></li></ol></ol><ol start="3" type="i"><li><div>乐观锁适用于写比较少的情况下（多读场景），即冲突真的很少发生的时候，这样可以省去了锁的开销，加大了系统的整个吞吐量。</div></li></ol><ol start="3" type="a"><li><div><span style="font-weight: bold;">悲观锁</span></div></li><ol type="i"><li><div>在操作数据时，认为此操作会出现数据冲突，所以在进行每次操作时都要通过获取锁才能进行对相同数据的操作,所以会耗费比较多的时间，悲观锁是由数据库自己实现了的，可以直接调用数据库的相关语句。</div></li><li><div>悲观锁涉及到另外两个锁:共享锁与排它锁</div></li><ol><li><div>共享锁:</div></li><ol type="a"><li><div>又被称为读锁，其他用户可以并发读取数据(不断加读锁)，但任何事务都不能获取数据上的排他锁，直到已释放所有共享锁。</div></li><li><div>共享锁下其它用户可以并发读取，查询数据。但不能修改，增加，删除数据。资源共享.。</div></li><li><div>在执行语句后面加上lock in share mode</div></li></ol><li><div>排它锁:</div></li><ol type="a"><li><div>又称为写锁。若事务T对数据对象A加上X锁，则只允许T读取和修改A，其它任何事务都不能再对A加任何类型的锁，直到T释放A上的锁。</div></li><li><div>在更新操作(INSERT、UPDATE 或 DELETE)过程中始终应用排它锁。</div></li><li><div>在执行语句后面加上for update</div></li></ol></ol></ol></ol><ol start="4" type="a"><li><div>行锁:</div></li><ol><li><div>开销大，加锁慢；会出现死锁；锁定粒度小，发生锁冲突的概率低，并发度高</div></li></ol></ol><ol start="5" type="a"><li><div>表锁</div></li><ol><li><div>开销小，加锁快；不会出现死锁；锁定力度大，发生锁冲突概率高，并发度最低</div></li></ol></ol><ol start="6" type="a"><li><div>页锁</div></li><ol><li><div>开销和加锁速度介于表锁和行锁之间；会出现死锁；锁定粒度介于表锁和行锁之间，并发度一般</div></li></ol></ol><ol start="7" type="a"><li><div>死锁：</div></li><ol type="i"><li><div>并发的问题就少不了死锁,幸运的是mysql的回滚会解决不少死锁问题,但还是存在。</div></li><ol><li><div>两个（或以上）的session加锁顺序不一致</div></li></ol><li><div>解决:</div></li><ol><li><div>以固定的顺序访问表和行。</div></li><li><div>大事务拆小。大事务更倾向于死锁，如果业务允许，将大事务拆小。</div></li><li><div>在同一个事务中，尽可能做到一次锁定所需要的所有资源，减少死锁概率</div></li><li><div>在业务环境允许的情况下，尽量降低隔离级别</div></li><li><div>为表添加合理的索引。可以看到如果不走索引将会为表的每一行记录添加上锁，死锁的概率大大增大</div></li></ol></ol></ol><div><br/></div><div><br/></div></div><div><br/></div></body></html>