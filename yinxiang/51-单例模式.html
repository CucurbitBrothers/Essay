<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.4.0 (460661)"/><meta name="author" content="1404001663@qq.com"/><meta name="created" content="2018-09-02 02:13:55 +0000"/><meta name="source" content="desktop.win"/><meta name="source-application" content="yinxiang.win32"/><meta name="source-url" content="about:blank"/><meta name="updated" content="2020-04-28 06:34:15 +0000"/><title>51-单例模式</title></head><body><div><div><ul><li><div>基于__new__(线程安全)</div></li></ul><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div><span style="color: #000080; font-weight: bold; font-family: Monaco; font-size: 9pt;">import</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">threading</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="color: #000080; font-weight: bold; font-family: Monaco; font-size: 9pt;">class</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Singleton(</span><span style="color: #000080; font-family: Monaco; font-size: 9pt;">object</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">):</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        __instance_lock = threading.Lock()</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">        __fist_flag =</span> <span style="color: #000080; font-weight: bold; font-family: Monaco; font-size: 9pt;">True</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="color: #000080; font-weight: bold; font-family: Monaco; font-size: 9pt;">        def</span> <span style="color: #b200b2; font-family: Monaco; font-size: 9pt;">__init__</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">(</span><span style="color: #94558d; font-family: Monaco; font-size: 9pt;">self</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">):</span></div><div><span style="color: #000080; font-weight: bold; font-family: Monaco; font-size: 9pt;">                if</span> <span style="color: #94558d; font-family: Monaco; font-size: 9pt;">self</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">.__fist_flag:</span></div><div><span style="color: #94558d; font-family: Monaco; font-size: 9pt;">                    self</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">.__fist_flag =</span> <span style="color: #000080; font-weight: bold; font-family: Monaco; font-size: 9pt;">False</span></div><div><br style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);"/></div><div><span style="color: #000080; font-weight: bold; font-family: Monaco; font-size: 9pt;">        def</span> <span style="color: #b200b2; font-family: Monaco; font-size: 9pt;">__new__</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">(</span><span style="color: #94558d; font-family: Monaco; font-size: 9pt;">cls</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">, *args, **kwargs):</span></div><div><span style="color: #000080; font-weight: bold; font-family: Monaco; font-size: 9pt;">                if not</span> <span style="color: #000080; font-family: Monaco; font-size: 9pt;">hasattr</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">(Singleton,</span> <span style="color: #008080; font-weight: bold; font-family: Monaco; font-size: 9pt;">"__instance_lock"</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">):</span></div><div><span style="color: #000080; font-weight: bold; font-family: Monaco; font-size: 9pt;">                        with</span> <span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">Singleton.__instance_lock:</span></div><div><span style="color: #000080; font-weight: bold; font-family: Monaco; font-size: 9pt;">                                if not</span> <span style="color: #000080; font-family: Monaco; font-size: 9pt;">hasattr</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">(Singleton,</span> <span style="color: #008080; font-weight: bold; font-family: Monaco; font-size: 9pt;">"__instance_lock"</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">):</span></div><div><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">                                        Singleton.__instance_lock =</span> <span style="color: #000080; font-family: Monaco; font-size: 9pt;">object</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">.</span><span style="color: #b200b2; font-family: Monaco; font-size: 9pt;">__new__</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">(</span><span style="color: #94558d; font-family: Monaco; font-size: 9pt;">cls</span><span style="font-family: Monaco; font-size: 9pt; color: rgb(51, 51, 51);">)</span></div><div><span style="font-size: 9pt; color: rgb(0, 0, 128); font-weight: bold; font-family: Monaco;">                return</span> <span style="font-size: 9pt; font-family: Monaco;">Singleton.__instance_lock</span></div></div><div><br/></div><ul><li><div>使用装饰器</div></li><li><div>使用模块：天然的单例</div></li><li><div>使用元类</div></li></ul><div><br/></div></div><div>使用场景</div><ul><li><div>资源共享的情况下，避免由于资源操作时导致的性能损耗。如日志文件，应用配置。</div></li><li><div>控制资源的情况下，方便资源之间的互相通信。如线程池等。</div></li><ul><li><div>1.网站的计数器 2.应用配置 3.多线程池 4.数据库配置，数据库连接池 5.应用程序的日志应用....</div></li></ul></ul><div><br/></div></div><div><br/></div></body></html>