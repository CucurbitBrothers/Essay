<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.4.0 (460661)"/><meta name="altitude" content="67.92265319824219"/><meta name="author" content="1404001663@qq.com"/><meta name="created" content="2018-09-28 12:49:11 +0000"/><meta name="latitude" content="39.98086931705663"/><meta name="longitude" content="116.3070738110502"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2019-03-06 06:13:33 +0000"/><title>003-DCP</title></head><body><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); font-weight: bold; font-size: 24px;-evernote-highlight:true;">dcp架构，源码</span></span></div><ol><li><div>Model</div></li><ol><li><div><br/></div></li></ol><li><div>映射规则列表</div></li><ol><li><div>映射关系：</div></li><ul><li><div>移动规则</div></li><ul><li><div>拷贝：</div></li><ul><li><div>复制源点位的值</div></li></ul><li><div>移动</div></li><ul><li><div>复制源点位的值，并把源点位的值删掉</div></li></ul><li><div>赋值</div></li><ul><li><div>直接赋值（）</div></li></ul></ul><li><div>前置条件</div></li><ul><li><div>必须与 源点位 在同一个group下面</div></li></ul></ul><li><div><br/></div></li><li><div>映射规则历史版本</div></li><ol><li><div>is_major：默认为False，新建的时候赋值为 True，如果最新的版本不是已上线，则置位False</div></li></ol></ol><li><div><br/></div></li><li><div><br/></div></li><li><div><span style="font-size: 11.3pt; color: rgb(0, 0, 0); font-family: Menlo;">运行</span></div></li><ul><li><div><span style="font-size: 11.3pt; color: rgb(0, 0, 0); font-family: Menlo;">DCP_ENV=dev debug=1 python manage.py runserver</span></div></li></ul><li><div>修改测试bug</div></li><ol><li><div>新建 fix/....分支，修改代码</div></li><li><div>合并到 test，以及dev 分支</div></li><li><div><br/></div></li></ol></ol><div><br/></div><div><br/></div><div><span style="font-weight: bold; background-color: rgb(255, 250, 165); font-size: 24px;-evernote-highlight:true;">日常操作</span></div><ol><li><div>数仓环境</div></li><ol><li><div>pip install -r medical_stream/requirements.txt</div></li><li><div>Spark 任务</div></li><ul><li><div><span style="--inversion-type-color:  simple; color: rgb(3, 4, 4);">L2-L3 住院病历</span></div></li><ul><li><div><span style="box-sizing: border-box; font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(204, 230, 255); color: rgb(25, 31, 37); font-family: -apple-system, system-ui, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Segoe UI&quot;, system-ui, Roboto, &quot;Droid Sans&quot;, &quot;Helvetica Neue&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">spark</span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(204, 230, 255); color: rgb(25, 31, 37); font-family: -apple-system, system-ui, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Segoe UI&quot;, system-ui, Roboto, &quot;Droid Sans&quot;, &quot;Helvetica Neue&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">-submit --master local[*] </span><a href="http://run_streaming.py/" style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(204, 230, 255); color: rgb(25, 31, 37); font-family: -apple-system, system-ui, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Segoe UI&quot;, system-ui, Roboto, &quot;Droid Sans&quot;, &quot;Helvetica Neue&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">run_streaming.py</a><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(204, 230, 255); color: rgb(25, 31, 37); font-family: -apple-system, system-ui, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Segoe UI&quot;, system-ui, Roboto, &quot;Droid Sans&quot;, &quot;Helvetica Neue&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"> --task=inpatient_layer_3 --interval=5 --rate=5</span></div></li></ul></ul></ol><li><div><span style="color: rgb(3, 4, 4); --inversion-type-color: simple;">VDI Xshell </span></div></li></ol><ul><ul><li><div><span style="--inversion-type-color:  simple; color: rgb(3, 4, 4);">线上 </span><span style="font-size: 14px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: pre-wrap; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(25, 31, 37); font-family: -apple-system, system-ui, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Segoe UI&quot;, system-ui, Roboto, &quot;Droid Sans&quot;, &quot;Helvetica Neue&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">dig_disease表中维护的   disease_name  —》disease_group_id （real_disease_id）</span></div></li><li><div><span style="--inversion-type-color:  simple; color: rgb(3, 4, 4);">预发环境日志路径 /home/dev/prelogs/dcp/**</span></div></li></ul></ul><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></body></html>