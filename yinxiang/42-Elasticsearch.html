<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.4.0 (460661)"/><meta name="author" content="1404001663@qq.com"/><meta name="created" content="2018-09-01 11:39:39 +0000"/><meta name="source" content="desktop.win"/><meta name="source-application" content="yinxiang.win32"/><meta name="source-url" content="http://localhost:85/C03-Goods/GoodsSearch.html"/><meta name="updated" content="2020-04-28 15:56:18 +0000"/><title>42-Elasticsearch</title></head><body><div><div>问题  </div><div><br/></div><ol><li><div>说一说ES</div></li><ol><li><div><span style="font-size: 10pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">一个兼有</span><span style="font-size: 10pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 255); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">搜索引擎</span><span style="font-size: 10pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">和</span><span style="font-size: 10pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 255); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">NoSQL数据库功能</span><span style="font-size: 10pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">的开源系统，基于Java/Lucene构建，可以用于</span><span style="font-size: 10pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 255); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">全文搜索</span><span style="font-size: 10pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">，</span><span style="font-size: 10pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 255); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">结构化搜索</span><span style="font-size: 10pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">以及</span><span style="font-size: 10pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 255); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">近实时分析</span></div></li><li><div><span style="font-size: 10pt; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">是 面向文档型数据库</span></div></li><li><div><span style="font-size: 13px; color: rgb(0, 0, 0); font-family: Verdana;"><span style="color: rgb(0, 0, 0);">采用倒排索引，</span></span><span style="letter-spacing: normal; orphans: 2; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: arial, 宋体, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; box-sizing: border-box; outline: 0px; word-wrap: break-word; font-size: 10pt; font-weight: bold;">用来存储在全文搜索下某个单词在一个文档或者一组文档中的存储位置的映射</span></div></li><li><div><span style="font-size: 13px; color: rgb(51, 51, 51); font-family: arial;"><b><span style="color: rgb(51, 51, 51);">如果需要中分分支需要安装插件，</span></b></span><span style="font-size: 10pt; -webkit-font-smoothing: antialiased; box-sizing: border-box; letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">elasticsearch-analysis-ik</span><span style="font-size: 10pt; letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">来</span></div></li></ol><li><div>ES搜索引擎 如何根据文档中的type进行：</div></li></ol><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div><span style="color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">2.2 查询某个index下所有的type:</span><span style="color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </span></div><div><span style="color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">$ curl localhost:9200/films/_search</span><span style="color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"> </span></div><div><br style="box-sizing: border-box; color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/></div><div><span style="color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">2.3 查询某个index 下， 某个 type下所有的记录：</span><span style="color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"> </span></div><div><span style="color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">$ curl localhost:9200/films/md/_search?pretty=true</span><span style="color: rgb(0, 0, 0); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-size: 14px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"> </span></div><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;;"><br/></span></div></div><div><br/></div><ul><li><div><span style="font-size: 10pt;">ES实现</span></div></li><ol><li><div><span style="letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">Elasticsearch 不支持对中文进行分词建立索引（倒排索引：</span> <span style="box-sizing: border-box; outline: 0px; word-wrap: break-word; letter-spacing: normal; orphans: 2; text-indent: 28px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: arial, 宋体, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">也常被称为反向索引、置入档案或反向档案，是一种索引方法，被用来存储在全文搜索下某个单词在一个文档或者一组文档中的存储位置的映射</span></span><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">），需要配合扩展</span></span><span style="font-size: 10pt; -webkit-font-smoothing: antialiased; box-sizing: border-box; letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">elasticsearch-analysis-ik</span><span style="font-size: 10pt; letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">来实现中文分词处理</span></div></li><ul><li><div><span style="box-sizing: border-box; word-wrap: normal; border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; overflow: visible; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: transparent; border: 0px; white-space: pre; word-break: normal; background-position: initial initial; background-repeat: initial initial;"><span style="background-color: transparent; font-size: 10pt; color: rgb(36, 41, 46); font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.45;">./bin/elasticsearch-plugin install</span> <a href="https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.3.0/elasticsearch-analysis-ik-6.3.0.zip" style="background-color: transparent; font-size: 10pt; font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 1.45;">https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.3.0/elasticsearch-analysis-ik-6.3.0.zip</a></span></div></li></ul><li><div><span style="font-size: 10pt; color: rgb(36, 41, 46); font-family: SFMono-Regular;">修改配置文件 </span> <span style="letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">/config/elasticsearch.yml         <span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; white-space: pre; direction: ltr; border: none; overflow: auto; word-wrap: normal; letter-spacing: 0.2px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; break-inside: avoid; background-position: 0px 0px;">network.host: 10.211.55.5</span></span></div></li><li><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: Consolas;">使用haystack 对接Elasticsearch</span></div></li><ol><li><div><font style="font-size: 10pt;"><span style="letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">Haystack为Django提供了模块化的搜索。它的特点是统一的，熟悉的API，可以让你在不修改代码的情况下使用不同的搜索后端（比如 Solr, Elasticsearch, Whoosh, Xapian 等等）</span></font></div></li><li><div><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; direction: ltr; border: none; white-space: pre; background-position: 0px 0px; background-repeat: initial initial;"><span style="font-size: 10pt; break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;">pip install drf-haystack</span> <span style="letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; break-inside: avoid; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">drf-haystack是为了在REST framework中使用haystack而进行的封装（如果在Django中使用haystack，则安装django-haystack即可）</span></span></div><div><font style="font-size: 10pt;"><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; direction: ltr; border: none; white-space: pre; font-size: 10pt; break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; background-position: 0px 0px;">pip install elasticsearch==</span><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; direction: ltr; border: none; white-space: pre; font-size: 10pt; break-inside: avoid; color: rgb(245, 135, 31); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; background-position: 0px 0px;">2.4</span><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; direction: ltr; border: none; white-space: pre; font-size: 10pt; break-inside: avoid; color: rgb(245, 135, 31); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; background-position: 0px 0px;">.1</span></font></div></li><li><div><font style="font-size: 10pt;"><span style="letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">注册应用</span></font></div></li><li><div><font style="font-size: 10pt;"><span style="letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">在配置文件中配置haystack使用的搜索引擎后端</span></font></div></li><ul><li><div><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; direction: ltr; border: none; background: 0px 0px; white-space: pre;"><span style="font-size: 10pt; break-inside: avoid; color: rgb(142, 144, 140); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;"># 当添加、修改、删除数据时，自动生成索引</span></span></div><div><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; direction: ltr; border: none; white-space: pre; font-size: 10pt; break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; background-position: 0px 0px;">HAYSTACK_SIGNAL_PROCESSOR =</span> <span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; direction: ltr; border: none; white-space: pre; font-size: 10pt; break-inside: avoid; color: rgb(113, 140, 0); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; background-position: 0px 0px;">'haystack.signals.RealtimeSignalProcessor'</span></div></li></ul><li><div><font style="font-size: 10pt;"><span style="letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">创建索引类</span></font></div></li><ul><li><div><font style="font-size: 10pt;"><span style="letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">指明让搜索引擎对哪些字段建立索引</span></font></div></li><li><div><font style="font-size: 10pt;"><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; white-space: pre; direction: ltr; border: none; overflow: auto; word-wrap: normal; letter-spacing: 0.2px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">text = indexes.CharField(document=</span><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; white-space: pre; direction: ltr; border: none; overflow: auto; word-wrap: normal; letter-spacing: 0.2px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; break-inside: avoid; color: rgb(137, 89, 168); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">True</span><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; white-space: pre; direction: ltr; border: none; overflow: auto; word-wrap: normal; letter-spacing: 0.2px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">, use_template=</span><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; white-space: pre; direction: ltr; border: none; overflow: auto; word-wrap: normal; letter-spacing: 0.2px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; break-inside: avoid; color: rgb(137, 89, 168); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">True</span><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; white-space: pre; direction: ltr; border: none; overflow: auto; word-wrap: normal; letter-spacing: 0.2px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;">)</span></font></div></li><ul><li><div><font style="font-size: 10pt;"><span style="letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">document=True，表名该字段是主要进行关键字查询的字段</span></font></div></li><li><div><font style="font-size: 10pt;"><span style="letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">use_template=True 表示后续通过模板来指明 <span style="letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">索引值具体由哪些模型类字段组成</span></span></font></div></li></ul></ul><li><div><font style="font-size: 10pt;"><span style="letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">创建text字段使用的模板文件</span></font></div></li><li><div><font style="font-size: 10pt;"><span style="letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">手动生成初始索引</span></font></div></li><ul><li><div><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; white-space: pre; direction: ltr; border: none; overflow: auto; word-wrap: normal; background: 0px 0px; letter-spacing: 0.2px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; break-inside: avoid; color: rgb(51, 51, 51); font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">python manage.py rebuild_index</span></span></div></li></ul><li><div><font style="font-size: 10pt;"><span style="letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">创建序列化器</span></font></div></li><li><div><font style="font-size: 10pt;"><span style="letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">创建视图</span></font></div></li><li><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">定义路由</span></div></li></ol></ol></ul><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 16px; letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">开源的</span><span style="font-size: 16px; letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"> </span><span style="-webkit-font-smoothing: antialiased; -webkit-tap-highlight-color: transparent; text-size-adjust: none; font-size: 16px; background-image: initial; background-position: 0px 0px; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; letter-spacing: 0.2px; orphans: 3; widows: 3;"><a href="https://blog.csdn.net/cnweike/article/details/33736429" style="font-size: 16px; font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;">Elasticsearch</a></span><a href="https://www.elastic.co/" style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-size: 16px; background-color: rgb(255, 255, 255); letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(65, 131, 196); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; background-position: 0px 0px;"> </a><span style="font-size: 16px; letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">是目前全文搜索引擎的首选</span></div><div><span style="font-size: 16px; letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">它可以快速地储存、搜索和分析海量数据。维基百科、Stack Overflow、Github 都采用它</span></div><div><span style="font-size: 16px; letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">Elastic 是 Lucene 的封装，提供了 REST API 的操作接口，开箱即用。<a href="http://www.ruanyifeng.com/blog/2017/08/elasticsearch.html" style="font-size: 12pt; font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; color: rgb(51, 51, 51);">http://www.ruanyifeng.com/blog/2017/08/elasticsearch.html</a></span></div><div><span style="font-size: 16px; letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">Elasticsearch 是用Java实现的。</span></div><div><br/></div><div><font style="font-size: 10pt;"><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">elasticsearch 是一个兼有</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(0, 0, 255); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">搜索引擎</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">和</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(0, 0, 255); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">NoSQL数据库功能</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">的开源系统，基于Java/Lucene构建，可以用于</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(0, 0, 255); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">全文搜索</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">，</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(0, 0, 255); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">结构化搜索</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">以及</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(0, 0, 255); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">近实时分析</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">。可以说Lucene是当今最先进，最高效的全功能开源搜索引擎框架。 说明： Lucene：只是一个框架，要充分利用它的功能，需要使用JAVA，并且在程序中集成Lucene，学习成本高，Lucene确实非常复杂。 Elasticsearch 是 面向文档型数据库，这意味着它存储的是整个对象或者 文档，它不但会</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(0, 0, 255); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">存储它们</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">，还会为他们</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(0, 0, 255); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">建立索引</span><span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">，这样你就可以搜索他们了。 <span style="letter-spacing: 0.2px; orphans: 3; text-indent: 0px; text-transform: none; white-space: normal; widows: 3; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">在通过搜索引擎搜索时，搜索引擎将关键字在索引数据中进行快速对比查找，进而找到数据的真实存储位置</span></span></font></div><div><br/></div><h3 style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 16px; word-break: break-all; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 10pt; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 30px;">Elasticsearch的index</span></span></h3><p style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px 0px 16px; color: rgb(79, 79, 79); line-height: 26px; text-align: justify; word-break: break-all; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">    Elasticsearch的索引(index)是用于组织数据的逻辑命名空间（如数据库）。Elasticsearch的索引有一个或多个分片(shard)（默认为5）。分片是实际存储数据的Lucene索引，它本身就是一个搜索引擎。每个分片可以有零个或多个副本(replicas)（默认为1）。Elasticsearch索引还具有“类型”（如数据库中的表），允许您在索引中对数据进行逻辑分区。Elasticsearch索引中给定“类型”中的所有文档(documents)具有相同的属性（如表的模式）。 </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 10pt;"><img src="https://img-blog.csdn.net/20170814225416168?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvemdfaG92ZXI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" style="box-sizing: border-box; outline: 0px; margin: 24px 0px; max-width: 100%; word-break: break-all; cursor: zoom-in; font-family: &quot;Helvetica Neue&quot;; color: rgb(51, 51, 51);"/></span></div><p style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px 0px 16px; color: rgb(79, 79, 79); line-height: 26px; text-align: justify; word-break: break-all; font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">    图a显示了一个由三个主分片组成的Elasticsearch集群，每个主分片分别有一个副本。所有这些分片一起形成一个Elasticsearch索引，每个分片是Lucene索引本身。 </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="-en-paragraph:true;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">    图b演示了Elasticsearch索引，分片，Lucene索引和文档(document)之间的逻辑关系。</span></span></div><h4 style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 16px; word-break: break-all; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28px;">类比关系数据库术语</span></span></h4><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">Elasticsearch Index ~ Database</span></span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">Types ~ Tables</span></span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">Mapping ~ Schema </span></span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all;"><span style="font-size: 10pt;"><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">关系数据库 ⇒ 数据库 ⇒ 表 ⇒ 行 ⇒ 列(Columns)</span></span></span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">Elasticsearch ⇒ 索引 ⇒ 类型 ⇒ 文档 ⇒ 字段(Fields)</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">   </span> <span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">schema </span> <span style="letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(79, 79, 79); font-family: &quot;Microsoft YaHei&quot;, &quot;SF Pro Display&quot;, Roboto, Noto, Arial, &quot;PingFang SC&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;">MySQL的文档中指出，在物理上，模式与数据库是同义的，所以，模式和数据库是一回事</span></span></div><h3 style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 16px; word-break: break-all; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></h3><hr/><h3 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; orphans: 3; widows: 3; margin-top: 1.275em; margin-bottom: 0.85em; letter-spacing: 0.2px; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><font style="font-size: 14pt;"><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; orphans: 3; widows: 3; letter-spacing: 0.2px; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 14pt;"><span style="text-indent: 0px; font-size: 12px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; break-after: avoid; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">目录：</span></span></span></font></h3><ul style="margin-left: 30px; padding-left: 0px; font-size: 12px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">应用场景</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">solr VS ES</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">核心概念</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">ES模块结构</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">分片示例</span></div></li></ul><div style="margin: 10px auto; text-indent: 0px; font-size: 12px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="text-indent: 0px; font-size: 12px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">应用场景</span></div><hr style="color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/><ul style="margin-left: 30px; padding-left: 0px; font-size: 12px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><li style="background-color: rgb(255, 255, 255); list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">站内搜索：</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">主要和 Solr 竞争，属于后起之秀</span></div></li><li style="background-color: rgb(255, 255, 255); list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">NoSQL json文档数据库：</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">主要抢占 Mongo 的市场，它在读写性能上优于 Mongo ，同时也支持地理位置查询，还方便地理位置和文本混合查询，属于歪打正着 </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">（对比测试参见：</span><a href="http://blog.quarkslab.com/mongodb-vs-elasticsearch-the-quest-of-the-holy-performances.html" style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">http://blog.quarkslab.com/mongodb-vs-elasticsearch-the-quest-of-the-holy-performances.html</a><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">）</span></div></li><li style="list-style-type: disc;"><div><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">监控：</span><span style="font-size: 12px; background-color: rgb(255, 250, 165); color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;-evernote-highlight:true;">统计以及日志类时间序的数据的存储和分析以及可视化，这方面是引领者</span></div></li><li style="background-color: rgb(255, 255, 255); list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">国外：Wikipedia使用 ES 提供全文搜索并高亮关键字、StackOverflow结合全文搜索与地理位置查询、</span><span style="font-size: 12px; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: &quot;microsoft yahei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">Github使用Elasticsearch检索1300亿行的代码</span></div></li><li style="background-color: rgb(255, 255, 255); list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">国内：</span><span style="font-size: 12px; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: &quot;microsoft yahei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">百度（</span><span style="font-size: 12px; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: &quot;microsoft yahei&quot;; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">在casio、云分析、网盟、预测、文库、直达号、钱包、风控等业务上都应用了ES，单集群每天导入30TB+数据，总共每天60TB+）、</span><span style="font-size: 12px; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: &quot;microsoft yahei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">新浪</span><span style="font-size: 12px; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: &quot;microsoft yahei&quot;; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> </span><span style="font-size: 12px; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: &quot;microsoft yahei&quot;; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">（见</span><a href="http://www.cnblogs.com/tgzhu/p/6098103.html" style="font-size: 12px; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: &quot;microsoft yahei&quot;; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">大数据架构--log</a><span style="font-size: 12px; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: &quot;microsoft yahei&quot;; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">）</span><span style="font-size: 12px; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: &quot;microsoft yahei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">，阿里巴巴、腾讯等公司均有对ES的使用</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; color: rgb(0, 0, 0); font-family: &quot;microsoft yahei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">使用比较广泛的平台ELK(ElasticSearch, Logstash, <span style="background-color: rgb(255, 250, 165); font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;microsoft yahei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;-evernote-highlight:true;">Kibana</span><span style="background-color: rgb(255, 255, 255); font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;microsoft yahei&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">)</span></span></div></li></ul><div style="margin: 10px auto; text-indent: 0px; font-size: 12px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="text-indent: 0px; font-size: 12px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">solr VS ES</span></div><hr style="color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/><ul style="margin-left: 30px; padding-left: 0px; font-size: 12px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">Solr是Apache Lucene项目的开源企业搜索平台。其主要功能包括全文检索、命中标示、分面搜索、动态聚类、数据库集成，以及富文本（如Word、PDF）的处理。</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">Solr是高度可扩展的，并提供了分布式搜索和索引复制。Solr是最流行的企业级搜索引擎，Solr4 还增加了NoSQL支持。</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">Solr是用Java编写、运行在Servlet容器（如 Apache Tomcat 或Jetty）的一个独立的全文搜索服务器。 Solr采用了 Lucene Java 搜索库为核心的全文索引和搜索，并具有类似REST的HTTP/XML和JSON的API。</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">Solr强大的外部配置功能使得无需进行Java编码，便可对 其进行调整以适应多种类型的应用程序。Solr有一个插件架构，以支持更多的高级定制</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">Elasticsearch 与 Solr 的比较总结</span></div></li></ul><ol style="padding-left: 40px;"><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">二者安装都很简单</span></div></li><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">Solr 利用 Zookeeper 进行分布式管理，而 Elasticsearch 自身带有分布式协调管理功能</span></div></li><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">Solr 支持更多格式的数据，而 Elasticsearch 仅支持json文件格式</span></div></li><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">Solr 官方提供的功能更多，而 Elasticsearch 本身更注重于核心功能，高级功能多有第三方插件提供</span></div></li><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">Solr 在传统的搜索应用中表现好于 Elasticsearch，但在处理实时搜索应用时效率明显低于 Elasticsearch</span></div></li><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">Solr 是传统搜索应用的有力解决方案，但 Elasticsearch 更适用于新兴的实时搜索应用</span></div></li></ol><div style="margin: 10px auto; text-indent: 0px; font-size: 12px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="text-indent: 0px; font-size: 12px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">核心概念</span></div><hr style="color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/><ul style="margin-left: 30px; padding-left: 0px; font-size: 12px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">集群（Cluster):</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">包含一个或多个具有相同</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> </span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">cluster.name</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">的节点.</span></div></li></ul><ol style="padding-left: 40px; text-align: start;"><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">集群内节点协同工作，共享数据，并共同分担工作负荷。</span></div></li><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">由于节点是从属集群的，集群会自我重组来</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">均匀地分发数据</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">. </span></div></li><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">cluster Name是很重要的，因为每个节点只能是群集的一部分，当该节点被设置为相同的名称时，就会</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">自动加入群集</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">。</span></div></li><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">集群中通过选举产生</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">一个mater节点</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">，它将负责管理集群范畴的变更，例如创建或删除索引，添加节点到集群或从集群删除节点。master 节点无需参与文档层面的变更和搜索，这意味着仅有一个 master 节点并不会因流量增长而成为瓶颈。任意一个节点都可以成为 master 节点。我们例举的集群只有一个节点，因此它会扮演 master 节点的角色。</span></div></li><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">作为用户，我们可以访问包括 master 节点在内的集群中的任一节点。每个节点都知道各个文档的位置，并能够将我们的请求直接转发到拥有我们想要的数据的节点。无论我们访问的是哪个节点，它都会控制从拥有数据的节点收集响应的过程，并返回给客户端最终的结果。这一切都是由 Elasticsearch 透明管理的</span></div></li></ol><ul style="margin-left: 30px; padding-left: 0px; font-size: 12px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">节点(node):</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> </span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">一个节点是一个</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">逻辑上独立的服务</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">，可以存储数据，并参与集群的索引和搜索功能, 一个节点也有唯一的名字，群集通过节点名称进行管理和通信.</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">索引（Index)：</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> </span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">索引与关系型数据库实例(Database)相当</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">。索引只是一个 逻辑命名空间，它指向一个或多个分片(shards)，内部用Apache Lucene实现索引中数据的读写</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">文档类型（Type）：</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">相当于数据库中的table概念</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">。每个文档在ElasticSearch中都必须设定它的类型。文档类型使得同一个索引中在存储结构不同文档时，只需要依据文档类型就可以找到对应的参数映射(Mapping)信息，方便文档的存取</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">文档（Document) ：</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">相当于数据库中的row</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">， 是可以被索引的基本单位。例如，你可以有一个的客户文档，有一个产品文档，还有一个订单的文档。文档是以JSON格式存储的。在一个索引中，您可以存储多个的文档。请注意，虽然在一个索引中有多分文档，但这些文档的结构是一致的，并在第一次存储的时候指定,</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> </span><span style="font-size: 12px; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">文档属于一种</span><span style="font-size: 12px; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> </span><span style="font-size: 16px; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">类型(type)</span><span style="font-size: 12px; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">，各种各样的类型存在于一个</span><span style="font-size: 12px; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> </span><span style="font-size: 16px; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">索引</span><span style="font-size: 12px; text-transform: none; text-indent: 0px; letter-spacing: normal; word-spacing: 0px; white-space: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); font-family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> 中。你也可以通过类比传统的关系数据库得到一些大致的相似之处：</span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; max-width: 900px; font-size: 12px !important;"><div style="margin: 0px 0px 0px 22px; white-space: pre-wrap; word-wrap: break-word; font-size: 12px !important;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">关系数据库 ⇒ 数据库 ⇒ 表 ⇒ 行 ⇒ 列(Columns)</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">Elasticsearch ⇒ 索引 ⇒ 类型 ⇒ 文档 ⇒ 字段(Fields)</span></div></div></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">模拟示意图如：</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"><img src="https://images2015.cnblogs.com/blog/1004194/201611/1004194-20161124180138409-1933404824.png" style="border: 0px; max-width: 900px; height: auto; font-weight: bold; font-family: &quot;Helvetica Neue&quot;; font-size: 14pt; color: rgb(51, 51, 51);" width="395"/></span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">Mapping：</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> </span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">相当于数据库中的schema，用来约束字段的类型，不过 Elasticsearch 的 mapping 可以自动根据数据创建</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">分片(shard) ：</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">是 工作单元(worker unit) 底层的一员，用来分配集群中的数据，它只负责保存索引中所有数据的一小片。</span></div></li></ul><ol style="padding-left: 40px;"><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">分片是一个独立的Lucene实例，并且它自身也是一个完整的搜索引擎。</span></div></li><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">文档存储并且被索引在分片中，但是我们的程序并不会直接与它们通信。取而代之，它们直接与索引进行通信的</span></div></li><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">把</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">分片</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">想象成一个</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">数据的容器</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">。</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">数据被存储在分片中</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">，然后分片又被</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">分配在集群的节点</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">上。当你的集群扩展或者缩小时，elasticsearch 会</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">自动的在节点之间迁移分配分片</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">，以便集群保持均衡</span></div></li><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">分片分为 主分片(primary shard) 以及 从分片(replica shard) 两种。在你的索引中，每一个文档都属于一个主分片</span></div></li><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">从</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">分片只是主分片的一个副</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">本，它用于提供数据的冗余副本，在硬件故障时提供数据保护，同时服务于搜索和检索这种只读请求</span></div></li><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">索引中的</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">主分片的数量在索引创建后就固定</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">下来了，但是从分片的数量可以随时改变。</span></div></li><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">一个索引默认设置了5个主分片，每个主分片有一个从分片对应</span></div></li></ol><div style="margin: 10px auto; text-indent: 0px; font-size: 12px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="text-indent: 0px; font-size: 12px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">ES模块结构</span></div><hr style="color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/><ul style="margin-left: 30px; padding-left: 0px; font-size: 12px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">模块结构图如下</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"><img src="https://images2015.cnblogs.com/blog/1004194/201611/1004194-20161124185700128-46209682.png" style="border: 0px; max-width: 900px; height: auto; font-weight: bold; font-family: &quot;Helvetica Neue&quot;; font-size: 14pt; color: rgb(51, 51, 51);" width="547"/></span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">Gateway:</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> </span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">代表ES的</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">持久化存储</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">方式，包含索引信息，ClusterState(集群信息)，mapping，索引碎片信息，以及transaction log等</span></div></li><ol style="padding-left: 40px;"><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">对于分布式集群来说，当一个或多个节点down掉了，能够保证我们的数据不能丢，最通用的解放方案就是对失败节点的数据进行复制，通过控制复制的份数可以保证集群有很高的可用性，复制这个方案的精髓主要是保证操作的时候没有单点，对一个节点的操作会同步到其他的复制节点上去。</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">ES一个</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">索引会拆分成多个碎片</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">，</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">每个碎片可以拥有一个或多个副本</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">（创建索引的时候可以配置），这里有个例子，每个索引分成3个碎片，每个碎片有2个副本，如下：</span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; max-width: 900px; font-size: 12px !important;"><div style="margin: 0px 0px 0px 22px; white-space: pre-wrap; word-wrap: break-word; font-size: 12px !important;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">$ curl -XPUT</span><span style="font-size: 12px;" /><a href="http://localhost:9200/twitter/" style="font-size: 12px; font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">http://localhost:9200/twitter/</a><span style="font-size: 12px;" /><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">-d</span><span style="font-size: 12px;" /><span style="font-size: 12px; color: rgb(128, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">'</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">index :</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">number_of_shards :</span><span style="font-size: 12px;" /><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">3</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">number_of_replicas :</span><span style="font-size: 12px;" /><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">2</span></div></div></div></li><li style="list-style-type: disc;"><div style="margin: 10px auto; text-indent: 0px;"><span style="text-indent: 0px; font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">每个操作会自动路由主碎片所在的节点，在上面执行操作，并且同步到其他复制节点，通过使用“non blocking IO”模式所有复制的操作都是并行执行的，也就是说如果你的</span><span style="text-indent: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">节点的副本越多</span><span style="text-indent: 0px; font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">，你</span><span style="text-indent: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">网络上的流量消耗也会越大</span><span style="text-indent: 0px; font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">。复制节点同样接受来自外面的读操作，意义就是你的</span><span style="text-indent: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">复制节点越多</span><span style="text-indent: 0px; font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">，你的</span><span style="text-indent: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">索引的可用性就越强</span><span style="text-indent: 0px; font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">，对</span><span style="text-indent: 0px; font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">搜索的可伸缩行就更好</span><span style="text-indent: 0px; font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">，能够承载更多的操作</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">第一次启动的时候，它会去持久化设备读取集群的状态信息（创建的索引，配置等）然后执行应用它们（创建索引，创建mapping映射等），每一次shard节点第一次实例化加入复制组，它都会从长持久化存储里面恢复它的状态信息</span></div></li></ol><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">Lucence Directory: </span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> </span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">是lucene的框架</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">服务发现以及选主 ZenDiscovery:</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> </span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">用来实现节点自动发现，还有Master节点选取，假如Master出现故障，其它的这个节点会自动选举，产生一个新的Master</span></div></li><ol style="padding-left: 40px;"><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">它是Lucene存储的一个抽象，由此派生了两个类：</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">FSDirectory和RAMDirectory，用于控制索引</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">文件的存储位置。使用FSDirectory类，就是存储到硬盘；使用RAMDirectory类，则是存储到内存</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"><img src="https://images2015.cnblogs.com/blog/1004194/201611/1004194-20161125104550456-1075794774.png" style="border: 0px; max-width: 900px; height: auto; font-weight: bold; font-family: &quot;Helvetica Neue&quot;; font-size: 14pt; color: rgb(51, 51, 51);"/></span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 14pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">一个Directory对象是一份文件的清单。文件可能只在被创建的时候写一次。一旦文件被创建，它将只被读取或者删除。在读取的时候进行写入操作是允许的</span></div></li></ol><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">Discovery</span></div></li></ul><ol style="padding-left: 40px;"><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">节点启动后</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">先ping</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">（这里的ping是 Elasticsearch 的一个RPC命令。如果</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;"> </span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-style: italic; font-weight: bold;">discovery.zen.ping.unicast.hosts</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-style: italic; font-weight: bold;"> </span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">有设置，则ping设置中的host，否则尝试ping localhost 的几个端口， Elasticsearch 支持同一个主机启动多个节点）</span></div></li><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">Ping的response会包含该节点的基本信息以及该节点认为的master节点</span></div></li><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">选举开始，先从各节点认为的master中选，规则很简单，按照id的字典序排序，取第一个</span></div></li><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">如果各节点都没有认为的master，则从所有节点中选择，规则同上。这里有个限制条件就是</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;"> </span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-style: italic; font-weight: bold;">discovery.zen.minimum_master_nodes</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">，如果节点数达不到最小值的限制，则循环上述过程，直到节点数足够可以开始选举</span></div></li><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">最后选举结果是肯定能选举出一个master，如果只有一个local节点那就选出的是自己</span></div></li><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">如果当前节点是master，则开始等待节点数达到 minimum_master_nodes，然后提供服务, 如果当前节点不是master，则尝试加入master.</span></div></li><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">ES支持任意数目的集群（1-N）,所以不能像 Zookeeper/Etcd 那样限制节点必须是奇数，也就无法用投票的机制来选主，而是通过一个规则，只要所有的节点都遵循同样的规则，得到的信息都是对等的，选出来的主节点肯定是一致的. 但分布式系统的问题就出在</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">信息不对等</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">的情况，这时候很容易出现</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">脑裂（Split-Brain）</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">的问题，大多数解决方案就是设置一个quorum值，要求</span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">可用节点必须大于quorum</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">（一般是超过半数节点），才能对外提供服务。而 Elasticsearch 中，这个quorum的配置就是</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;"> </span><span style="font-size: 12px; color: rgb(0, 0, 255); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">discovery.zen.minimum_master_nodes</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;"> </span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">。</span></div></li></ol><ul style="margin-left: 30px; padding-left: 0px; font-size: 12px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">memcached</span></div></li></ul><ol style="padding-left: 40px;"><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">通过memecached协议来访问ES的接口,支持二进制和文本两种协议.通过一个名为transport-memcached插件提供</span></div></li><li style="list-style-type: decimal;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-weight: bold;">Memcached命令会被映射到REST接口，并且会被同样的REST层处理，memcached命令列表包括：get/set/delete/quit</span></div></li></ol><ul style="margin-left: 30px; padding-left: 0px; font-size: 12px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">River :</span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> </span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">代表es的一个数据源，也是其它存储方式（如：数据库）同步数据到es的一个方法。它是以插件方式存在的一个es服务，通过读取river中的数据并把它索引到es中，官方的river有couchDB的，RabbitMQ的，Twitter的，Wikipedia的，river这个功能将会在后面的文件中重点说到</span></div></li></ul><div style="margin: 10px auto; text-indent: 0px; font-size: 12px; letter-spacing: normal; orphans: 2; text-align: start; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="text-indent: 0px; font-size: 12px; letter-spacing: normal; orphans: 2; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">分片示例</span></div><hr style="color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-size: 12px; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"/><ul style="margin-left: 30px; padding-left: 0px; font-size: 12px; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">启用一个既没有数据，也没有索引的单一节点, 如下图</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"><img src="https://images2015.cnblogs.com/blog/1004194/201611/1004194-20161125113639190-848778968.png" style="border: 0px; max-width: 900px; height: auto; font-weight: bold; font-family: &quot;Helvetica Neue&quot;; font-size: 14pt; color: rgb(51, 51, 51);"/></span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">在空的单节点集群中上创建一个叫做 blogs 的索引，设置3个主分片和一组从分片（每个主分片有一个从分片对应），代码如下：</span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; max-width: 900px; font-size: 12px !important;"><div style="margin: 0px 0px 0px 22px; white-space: pre-wrap; word-wrap: break-word; font-size: 12px !important;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">PUT /</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">blogs</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">{</span></div><div><span style="font-size: 12px; color: rgb(128, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">"</span><span style="font-size: 12px; color: rgb(128, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">settings</span><span style="font-size: 12px; color: rgb(128, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">"</span><span style="font-size: 12px;" /><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">: {</span></div><div><span style="font-size: 12px; color: rgb(128, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">"</span><span style="font-size: 12px; color: rgb(128, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">number_of_shards</span><span style="font-size: 12px; color: rgb(128, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">"</span><span style="font-size: 12px;" /><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">: 3</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">,</span></div><div><span style="font-size: 12px; color: rgb(128, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">"</span><span style="font-size: 12px; color: rgb(128, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">number_of_replicas</span><span style="font-size: 12px; color: rgb(128, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">"</span><span style="font-size: 12px;" /><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">: 1</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">}</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">}</span></div></div></div></li><li style="list-style-type: disc;"><div style="margin: 10px auto; text-indent: 0px;"><span style="text-indent: 0px; font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> 集群示例图如下： （</span><span style="text-indent: 0px; font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-style: italic; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">此时集群健康状态为： yellow   三个从分片还没有被分配到节点上</span><span style="text-indent: 0px; font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">)</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"><img src="https://images2015.cnblogs.com/blog/1004194/201611/1004194-20161125113848987-1256292980.png" style="border: 0px; max-width: 900px; height: auto; font-weight: bold; font-family: &quot;Helvetica Neue&quot;; font-size: 14pt; color: rgb(51, 51, 51);"/></span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">   </span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"><img src="https://images2015.cnblogs.com/blog/1004194/201611/1004194-20161125114033628-614065394.png" style="border: 0px; max-width: 900px; height: auto; font-weight: bold; font-family: &quot;Helvetica Neue&quot;; font-size: 14pt; color: rgb(51, 51, 51);"/></span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">主分片(primary shards) 启动并且运行了，这时集群已经可以成功的处理任意请求，但是 从分片(replica shards) 没有完全被激活。事实上，当前这三个从分片都处于 unassigned（未分配）的状态，它们还未被分配到节点上。在同一个节点上保存相同的数据副本是没有必要的，如果这个节点故障了，就等同于所有的数据副本也丢失了</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">启动第二个节点，配置第二个节点与第一个节点的 cluster.name 相同（./config/elasticsearch.yml文件中的配置），它就能自动发现并加入到第一个节点的集群中,如下图：</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"><img src="https://images2015.cnblogs.com/blog/1004194/201611/1004194-20161125114323550-385234299.png" style="border: 0px; max-width: 900px; height: auto; font-weight: bold; font-family: &quot;Helvetica Neue&quot;; font-size: 14pt; color: rgb(51, 51, 51);"/></span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">  </span><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> </span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"><img src="https://images2015.cnblogs.com/blog/1004194/201611/1004194-20161125114345612-1091464476.png" style="border: 0px; max-width: 900px; height: auto; font-weight: bold; font-family: &quot;Helvetica Neue&quot;; font-size: 14pt; color: rgb(51, 51, 51);"/></span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">cluster-health 的状态为 green，这意味着所有的6个分片（三个主分片和三个从分片）都已激活，文档在主节点和从节点上都能被检索</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">随着应用需求的增长，启动第三个节点进行横向扩展，集群内会自动重组，如图</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"><img src="https://images2015.cnblogs.com/blog/1004194/201611/1004194-20161125114656253-121641653.png" style="border: 0px; max-width: 900px; height: auto; font-weight: bold; font-family: &quot;Helvetica Neue&quot;; font-size: 14pt; color: rgb(51, 51, 51);"/></span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">在 Node 1 和 Node 2 中分别会有一个分片被移动到 Node 3 上，这样一来，每个节点上就都只有两个分片了。这意味着每个节点的硬件资源（CPU、RAM、I/O）被更少的分片共享，所以每个分片就会有更好的性能表现</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">一共有6个分片（3个主分片和3个从分片），因此最多可以扩展到6个节点，每个节点上有一个分片，这样每个分片都可以使用到所在节点100%的资源了</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">主分片的数量在索引创建的时候就已经指定了，实际上，这个数字定义了能存储到索引中的数据最大量（具体的数量取决于你的数据，硬件的使用情况）。例如，读请求——搜索或者文档恢复就可以由主分片或者从分片来执行，所以当你拥有更多份数据的时候，你就拥有了更大的吞吐量</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">从分片的数量可以在运行的集群中动态的调整，这样我们就可以根据实际需求扩展或者缩小规模。接下来，我们来增加一下从分片组的数量：</span></div><div style="background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); padding: 5px; overflow: auto; margin: 5px 0px; max-width: 900px; font-size: 12px !important;"><div style="margin: 0px 0px 0px 22px; white-space: pre-wrap; word-wrap: break-word; font-size: 12px !important;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">PUT /blogs/</span><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">_settings</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">{</span></div><div><span style="font-size: 12px; color: rgb(128, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">"</span><span style="font-size: 12px; color: rgb(128, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">number_of_replicas</span><span style="font-size: 12px; color: rgb(128, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">"</span><span style="font-size: 12px;" /><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">: 2</span></div><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 1.5;">}</span></div></div></div></li><li style="list-style-type: disc;"><div style="margin: 10px auto; text-indent: 0px;"><span style="text-indent: 0px; font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;"> 现在 blogs 的索引总共有9个分片：3个主分片和6个从分片， 又会变成一个节点一个分片的状态了,最终得到了三倍搜索性能的三节点集群</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"><img src="https://images2015.cnblogs.com/blog/1004194/201611/1004194-20161125115353034-132051281.png" style="border: 0px; max-width: 900px; height: auto; font-weight: bold; font-family: &quot;Helvetica Neue&quot;; font-size: 14pt; color: rgb(51, 51, 51);"/></span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">说明：仅仅是在同样数量的节点上增加从分片的数量是根本不能提高性能的，因为每个分片都有访问系统资源的权限。你需要升级硬件配置以提高吞吐量。</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">尝试一下,把第一个节点杀掉，我们的集群就会如下图所示：</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(0, 0, 0); font-family: Verdana, &quot;Lucida Grande&quot;, Arial, Helvetica, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal;"><img src="https://images2015.cnblogs.com/blog/1004194/201611/1004194-20161125115935112-1907307214.png" style="border: 0px; max-width: 900px; height: auto; font-weight: bold; font-family: &quot;Helvetica Neue&quot;; font-size: 14pt; color: rgb(51, 51, 51);"/></span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">被杀掉的节点是主节点，主分片 1 和 2 在我们杀掉 Node 1 后就丢失了，我们的索引在丢失主节点的时候是不能正常工作的。如果我们在这个时候检查集群健康状态，将会显示 red：存在不可用的主节点</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">而为了集群的正常工作必须需要一个主节点，所以首先进行的进程就是从各节点中选择了一个新的主节点：Node 2</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">新的主节点所完成的第一件事情就是将这些在 Node 2 和 Node 3 上的从分片提升为主分片，然后集群的健康状态就变回至 yellow。这个提升的进程是瞬间完成了，就好像按了一下开关</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">如果再次杀掉 Node 2 的时候，我们的程序依旧可以在没有丢失任何数据的情况下运行，因为 Node 3 中依旧拥有每个分片的备份</span></div></li><li style="list-style-type: disc;"><div><span style="font-size: 12px; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">如果我们重启 Node 1，集群就能够重新分配丢失的从分片，这样结果就会与三节点两从集群一致。如果 Node 1 依旧还有旧节点的内容，系统会尝试重新利用他们，并只会复制在故障期间的变更数据</span></div></li></ul><hr/><h3 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; orphans: 3; widows: 3; margin-top: 1.275em; margin-bottom: 0.85em; letter-spacing: 0.2px; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><h3 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; orphans: 3; widows: 3; margin-top: 1.275em; margin-bottom: 0.85em; letter-spacing: 0.2px; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><h3 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; orphans: 3; widows: 3; margin-top: 1.275em; margin-bottom: 0.85em; letter-spacing: 0.2px; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><h3 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; orphans: 3; widows: 3; margin-top: 1.275em; margin-bottom: 0.85em; letter-spacing: 0.2px; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><h3 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; orphans: 3; widows: 3; margin-top: 1.275em; margin-bottom: 0.85em; letter-spacing: 0.2px; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><h3 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; orphans: 3; widows: 3; margin-top: 1.275em; margin-bottom: 0.85em; letter-spacing: 0.2px; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><h3 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; orphans: 3; widows: 3; margin-top: 1.275em; margin-bottom: 0.85em; letter-spacing: 0.2px; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><h3 style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; orphans: 3; widows: 3; margin-top: 1.275em; margin-bottom: 0.85em; letter-spacing: 0.2px; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px; -webkit-text-stroke-width: 0px;"/><div><br/></div><div><br/></div><div><br/></div><div><br/></div><h3 style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 16px; word-break: break-all; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; font-size: 10pt; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 30px;">Elasticsearch集群的节点类型</span></h3><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px 0px 16px; text-align: justify; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">    Elasticsearch的一个实例是一个节点，一组节点形成一个集群。Elasticsearch集群中的节点可以通过三种不同的方式进行配置：</span></div><h4 style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 16px; word-break: break-all; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28px;">Master节点</span></h4><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">Master节点控制Elasticsearch集群，并负责在集群范围内创建/删除索引，跟踪哪些节点是集群的一部分，并将分片分配给这些节点。主节点一次处理一个集群状态，并将状态广播到所有其他节点，这些节点需要响应并确认主节点的信息。</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">在elasticsearch.yml中，将nodes.master属性设置为true（默认），可以将节点配置为有资格成为主节点的节点。</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">对于大型生产集群，建议用一个专用主节点来控制集群，并且不服务任何用户请求。</span></div><h4 style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 16px; word-break: break-all; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28px;">Data节点</span></h4><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">数据节点用来保存数据和倒排索引。默认情况下，每个节点都配置为一个data节点，并且在elasticsearch.yml中将属性node.data设置为true。如果您想要一个专用的master节点，那么将node.data属性更改为false。</span></div><h4 style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 16px; word-break: break-all; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28px;">Client节点</span></h4><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">    如果将node.master和node.data设置为false，则将节点配置为客户端节点，并充当负载平衡器，将传入的请求路由到集群中的不同节点。 </span></div><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">    若你连接的是作为客户端的节点，该节点称为协调节点(coordinating node)。协调节点将客户机请求路由到集群中对应分片所在的节点。对于读取请求，协调节点每次选择不同的分片来提供请求以平衡负载。 </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;-en-paragraph:true;">    在我们开始审查发送到协调节点的CRUD请求如何通过集群传播并由引擎执行之前，让我们看看Elasticsearch如何在内部存储数据，以低延迟为全文搜索提供结果。</span></div><h4 style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 16px; word-break: break-all; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28px;">存储模型</span></h4><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">    Elasticsearch使用Apache Lucene，它是由Java编写的全文搜索库，由Doug Cutting（Apache Hadoop的创建者）内部开发，它使用称为倒排索引的数据结构，用于提供低延迟搜索结果。 </span></div><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">    文档（document）是Elasticsearch中的数据单位，并通过对文档中的术语进行标记来创建倒排索引，创建所有唯一术语的排序列表，并将文档列表与可以找到该词的位置相关联。 </span></div><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">    它非常类似于一本书背面的索引，其中包含书中的所有独特的单词和可以找到该单词的页面列表。当我们说一个文档被索引时，我们引用倒排索引。我们来看看下面两个文档的倒排索引如何看待： </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><img src="https://img-blog.csdn.net/20170814225953744?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvemdfaG92ZXI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" style="box-sizing: border-box; outline: 0px; margin: 24px 0px; max-width: 100%; word-break: break-all; cursor: zoom-in; font-family: &quot;Helvetica Neue&quot;; color: rgb(51, 51, 51);"/></div><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">    如果我们想要找到包含术语“insight”的文档，我们可以扫描倒排的索引（在哪里排序），找到“insight”这个词，并返回包含这个单词的文档ID，这在这种情况下将是文档1和Doc 2号文件。 </span></div><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">    为了提高可搜索性（例如，为小写字母和小写字提供相同的结果），首先分析文档并对其进行索引。 </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;-en-paragraph:true;">    分析由两部分组成：</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">将句子标记成单词</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">将单词规范化为标准表单 </span></div><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">默认情况下，Elasticsearch使用标准分析器</span></div></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">标准标记器(Standard tokenizer)，用于在单词边界上分割单词</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">小写令牌过滤器(Lowercase token filter)将单词转换为小写 </span></div><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">还有许多其他分析仪可用，您可以在文档中阅读它们。 </span></div><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">注意：标准分析仪也使用停止令牌过滤器，但默认情况下禁用。</span></div></div><h2 style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 16px; word-break: break-all; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 32px;">实现原理分析</span></h2><h3 style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 16px; word-break: break-all; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 30px;">write(写)/create(创建)操作实现原理</span></h3><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px 0px 16px; text-align: justify; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">当您向协调节点发送请求以索引新文档时，将执行以下操作：</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">所有在Elasticsearch集群中的节点都包含：有关哪个分片存在于哪个节点上的元数据。协调节点(coordinating node)使用文档ID（默认）将文档路由到对应的分片。Elasticsearch将文档ID以murmur3作为散列函数进行散列，并通过索引中的主分片数量进行取模运算，以确定文档应被索引到哪个分片。 </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="box-sizing: border-box; outline: 0px; background-color: rgb(249, 242, 244); border-top-left-radius: 2px; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 2px; word-break: break-all; font-size: 10pt; color: rgb(199, 37, 78); font-family: Consolas, Inconsolata, Courier, monospace; line-height: 22px;-en-paragraph:true;">shard = hash(document_id) % (num_of_primary_shards)</span></div></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px 0px 16px; text-align: justify; word-break: break-all;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; font-size: 10pt; color: rgb(79, 79, 79); font-family: &quot;Helvetica Neue&quot;; line-height: 26px;">当节点接收到来自协调节点的请求时，请求被写入到translog（我们将在后续的post中间讲解translog），并将该文档添加到内存缓冲区。如果请求在主分片上成功，则请求将并行发送到副本分片。只有在所有主分片和副本分片上的translog被fsync’ed后，客户端才会收到该请求成功的确认。</span></div></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">内存缓冲区以固定的间隔刷新（默认为1秒），并将内容写入文件系统缓存中的新段。此分段的内容更尚未被fsync’ed(未被写入文件系统)，分段是打开的，内容可用于搜索。</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">translog被清空，并且文件系统缓存每隔30分钟进行一次fsync，或者当translog变得太大时进行一次fsync。这个过程在Elasticsearch中称为flush。在刷新过程中，内存缓冲区被清除，内容被写入新的文件分段(segment)。当文件分段被fsync’ed并刷新到磁盘，会创建一个新的提交点（其实就是会更新文件偏移量，文件系统会自动做这个操作）。旧的translog被删除，一个新的开始。</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">下图显示了写入请求和数据流程： </span></div><div><img src="https://img-blog.csdn.net/20170814230326817?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvemdfaG92ZXI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" style="box-sizing: border-box; outline: 0px; margin: 24px 0px; max-width: 100%; word-break: break-all; cursor: zoom-in; font-family: &quot;Helvetica Neue&quot;; color: rgb(51, 51, 51);"/></div></div><h3 style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 16px; word-break: break-all; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 30px;">Update和Delete实现原理</span></h3><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">    删除和更新操作也是写操作。但是，Elasticsearch中的文档是不可变的(immutable)，因此不能删除或修改。那么，如何删除/更新文档呢？ </span></div><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">    磁盘上的每个分段(segment)都有一个.del文件与它相关联。当发送删除请求时，该文档未被真正删除，而是在.del文件中标记为已删除。此文档可能仍然能被搜索到，但会从结果中过滤掉。当分段合并时（我们将在后续的帖子中包括段合并），在.del文件中标记为已删除的文档不会被包括在新的合并段中。 </span></div><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">    现在，我们来看看更新是如何工作的。创建新文档时，Elasticsearch将为该文档分配一个版本号。对文档的每次更改都会产生一个新的版本号。当执行更新时，旧版本在.del文件中被标记为已删除，并且新版本在新的分段中编入索引。旧版本可能仍然与搜索查询匹配，但是从结果中将其过滤掉。 </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;-en-paragraph:true;">    indexed/updated文档后，我们希望执行搜索请求。我们来看看如何在Elasticsearch中执行搜索请求。</span></div><h3 style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 16px; word-break: break-all; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 30px;">Read的实现原理</span></h3><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px 0px 16px; text-align: justify; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">读操作由两个阶段组成：</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">查询阶段（Query Phase）</span></div><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 0px 32px; list-style-type: disc; word-break: break-all;"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">获取阶段（Fetch Phase）</span></div><h4 style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 16px; word-break: break-all; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28px;">查询阶段(Query Phase)</span></h4><div style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 0px 0px 16px; text-align: justify; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; line-height: 26px;">    在此阶段，协调节点将搜索请求路由到索引(index)中的所有分片(shards)（包括：主要或副本）。分片独立执行搜索，并根据相关性分数创建一个优先级排序结果（稍后我们将介绍相关性分数）。所有分片将匹配的文档和相关分数的文档ID返回给协调节点。协调节点创建一个新的优先级队列，并对全局结果进行排序。可以有很多文档匹配结果，但默认情况下，每个分片将前10个结果发送到协调节点，协调创建优先级队列，从所有分片中分选结果并返回前10个匹配。</span></div><h4 style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 16px; word-break: break-all; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28px;">获取阶段(Fetch Phase)</span></h4><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">    在协调节点对所有结果进行排序，已生成全局排序的文档列表后，它将从所有分片请求原始文档。 </span></div><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">    所有的分片都会丰富文档并将其返回到协调节点。 </span></div><div><img src="https://img-blog.csdn.net/20170814230558199?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvemdfaG92ZXI=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" style="box-sizing: border-box; outline: 0px; margin: 24px 0px; max-width: 100%; word-break: break-all; cursor: zoom-in; font-family: &quot;Helvetica Neue&quot;; color: rgb(51, 51, 51);"/></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;-en-paragraph:true;">如上所述，搜索结果按相关性排序。我们来回顾一下相关性的定义。</span></div><h4 style="box-sizing: border-box; outline: 0px; padding: 0px; margin: 8px 0px 16px; word-break: break-all; letter-spacing: normal; orphans: 2; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; outline: 0px; word-break: break-all; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); font-size: 10pt; color: rgb(79, 79, 79); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold; line-height: 28px;">搜索相关性(Search Relevance)</span></h4><div><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;">    相关性由Elasticsearch给予搜索结果中返回的每个文档的分数确定。用于评分的默认算法为tf / idf（术语频率/逆文档频率）。该术语频率测量术语出现在文档中的次数（更高频率=更高的相关性），逆文档频率测量术语在整个索引中出现的频率占索引中文档总数的百分比（更高的频率 </span></div><div style="margin-top: 1em; margin-bottom: 1em;"><span style="font-size: 10pt; color: rgb(51, 51, 51); font-family: &quot;Helvetica Neue&quot;;-en-paragraph:true;">==较少的相关性）。最终得分是tf-idf分数与其他因素（如词语邻近度（短语查询）），术语相似度（用于模糊查询）等的组合。</span></div><div><br style="font-family: &quot;Helvetica Neue&quot;; color: rgb(51, 51, 51);"/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 0.85em; white-space: pre; break-inside: avoid; direction: ltr; border: none; color: rgb(51, 51, 51); overflow: auto; word-wrap: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: 0.2px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: 0px 0px;">docker run -dti --network=host --name=elasticsearch -v</span></div><div><span style="-webkit-font-smoothing: antialiased; box-sizing: border-box; font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 0.85em; white-space: pre; break-inside: avoid; direction: ltr; border: none; color: rgb(51, 51, 51); overflow: auto; word-wrap: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: 0.2px; orphans: 2; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-position: 0px 0px;">/home/python/elasticsearch-2.4.6/config:/usr/share/elasticsearch/config delron/elasticsearch-ik:2.4.6-1.0</span></div></div><div style="-webkit-font-smoothing: antialiased; box-sizing: border-box; -webkit-tap-highlight-color: transparent; text-size-adjust: none; orphans: 3; widows: 3; margin-top: 0px; margin-bottom: 0.85em;"/></div><div><br/></div></body></html>